<project>
	<macrodef name="install-model-file">
		<attribute name="file"/>
		<attribute name="extension"/>
		<attribute name="variant"/>
		<attribute name="tool"/>
		<attribute name="language"/>
		<attribute name="version"/>
		<attribute name="md5"/>
		<attribute name="prop.verify.md5" default="verify.md5.@{tool}.@{language}.@{variant}"/>
		<attribute name="prop.verify.md5.actual" default="verify.md5.actual.@{tool}.@{language}.@{variant}"/>
		<sequential>
			<fail unless="outputDir">No output directory set.</fail>
	    	<mkdir dir="${outputDir}/lib"/>
			<copy file="@{file}" tofile="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}"/>
			<copy file="@{file}.props" tofile="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}.props" failonerror="false"/>
			
			<generate-model-properties tool="@{tool}" language="@{language}" variant="@{variant}"
				extension="@{extension}"/>
			<clean-pom/>
			<generate-pom version="@{version}" groupId="de.tudarmstadt.ukp.dkpro.core" 
				artifactId="de.tudarmstadt.ukp.dkpro.core.stanfordnlp-model-@{tool}-@{language}-@{variant}"/>
			
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{md5}" verifyproperty="@{prop.verify.md5}"/>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.verify.md5.actual}"/>
			<condition property="checksum.mismatch">
				<equals arg1="false" arg2="${@{prop.verify.md5}}"/>
			</condition>
			<fail if="checksum.mismatch">
MD5 checksum mismatch for @{tool}-@{language}-@{variant}.@{extension}.
Please verify the checksum and if necessary update this script.
Expected: @{md5}
Actual  : ${@{prop.verify.md5.actual}}
			</fail>

			<jar destfile="target/stanfordnlp-model-@{tool}-@{language}-@{variant}-@{version}.jar" compress="true">
				<fileset dir="target/stanfordnlp-resources">
					<include name="META-INF/**/*"/>
					<include name="**/lib/@{tool}-@{language}-@{variant}*"/>
				</fileset>
			</jar>
			
			<clean-pom/>
		</sequential>
	</macrodef>

	<macrodef name="generate-model-properties">
		<attribute name="tool"/>
		<attribute name="language"/>
		<attribute name="extension"/>
		<attribute name="variant"/>
		<attribute name="prop.checksum.md5" default="checksum.md5.@{tool}-@{language}-@{variant}"/>
		<attribute name="prop.checksum.sha1" default="checksum.sha1.@{tool}-@{language}-@{variant}"/>
		<sequential>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.checksum.md5}"
				algorithm="MD5"/>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.checksum.sha1}"
				algorithm="SHA"/>
			<propertyfile file="${outputDir}/lib/@{tool}-@{language}-@{variant}.properties"
				comment="Stanford NLP tools model description">
				<entry  key="downloaded" type="date" value="now"/>
				<entry  key="tool" value="@{tool}"/>
				<entry  key="language" value="@{language}"/>
				<entry  key="variant" value="@{variant}"/>
				<entry  key="md5" value="${@{prop.checksum.md5}}"/>
				<entry  key="sha1" value="${@{prop.checksum.sha1}}"/>
			</propertyfile>
			<echo>Installed @{tool} model file for @{language} in variant @{variant}</echo>
		</sequential>
	</macrodef>

	<target name="test">
		<generate-pom groupId="muahah" artifactId="lala" version="huaua"/>
	</target>
	
	<macrodef name="generate-pom">
		<attribute name="groupId"/>
		<attribute name="artifactId"/>
		<attribute name="version"/>
		<sequential>
			<mkdir dir="target/stanfordnlp-resources/META-INF/maven/@{groupId}/@{artifactId}"/>
			<echo file="target/stanfordnlp-resources/META-INF/maven/@{groupId}/@{artifactId}/pom.xml"><![CDATA[<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>@{groupId}</groupId>
	<artifactId>@{artifactId}</artifactId>
	<version>@{version}</version>
</project>
]]></echo>
			<echo file="target/stanfordnlp-resources/META-INF/maven/@{groupId}/@{artifactId}/pom.properties"><![CDATA[version=@{version}
groupId=@{groupId}
artifactId=@{artifactId}
]]></echo>
		</sequential>
	</macrodef>
	
	<macrodef name="clean-pom">
		<sequential>
			<delete dir="target/stanfordnlp-resources/META-INF"/>
		</sequential>
	</macrodef>
</project>